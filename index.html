<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç©ºæ°—ã‚’ãŠã—ã¦ã¿ã‚ˆã†</title>
    <!-- ãƒ‡ã‚¶ã‚¤ãƒ³ç”¨ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª (Tailwind CSS) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆ (Google Fonts) -->
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            overflow: hidden; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ */
            touch-action: none; /* ã‚¿ãƒƒãƒæ“ä½œã§ã®ç”»é¢ã‚ºãƒ¼ãƒ ç­‰ã‚’é˜²æ­¢ */
            user-select: none; /* ãƒ†ã‚­ã‚¹ãƒˆé¸æŠé˜²æ­¢ */
            background-color: #f0f9ff;
        }

        /* ç©ºæ°—ã®ç²’ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .particle {
            position: absolute;
            border-radius: 50%;
            transition: background-color 0.2s;
            pointer-events: none;
        }
        .particle.air {
            background-color: #60a5fa; /* æ°´è‰² */
            width: 8px;
            height: 8px;
            opacity: 0.8;
            box-shadow: 0 0 4px rgba(96, 165, 250, 0.5);
        }

        /* æ¡ã£ã¦ã„ã‚‹ã¨ãã®ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ« */
        .grabbing {
            cursor: grabbing !important;
        }
        .cursor-grab {
            cursor: grab;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

    <!-- ã‚¿ã‚¤ãƒˆãƒ«ã‚¨ãƒªã‚¢ -->
    <div class="mb-6 text-center z-10">
        <h1 class="text-2xl md:text-3xl font-bold text-slate-700 mb-2">ã¨ã˜ã“ã‚ãŸç©ºæ°—ã‚’ãŠã—ã¦ã¿ã‚ˆã†</h1>
        <p class="text-slate-600 text-sm md:text-base">ãƒ”ã‚¹ãƒˆãƒ³ã‚’ <span class="font-bold text-blue-600">å·¦ã¸ã‚°ã‚°ãƒ¼ãƒƒ</span> ã¨ãŠã—ã¦ã­</p>
    </div>

    <!-- ã‚¢ãƒ—ãƒªæœ¬ä½“ï¼ˆæ³¨å°„å™¨ã‚¨ãƒªã‚¢ï¼‰ -->
    <div id="app-container" class="relative w-full max-w-3xl bg-white rounded-2xl shadow-xl p-6 md:p-12 overflow-visible border-4 border-slate-200">
        
        <!-- æ³¨å°„å™¨ã®å…¨ä½“ -->
        <div class="relative w-full h-32 md:h-40 flex items-center select-none">
            
            <!-- 1. æ³¨å°„å™¨ã®ç­’ï¼ˆå…ˆç«¯ï¼‰ -->
            <div class="absolute left-0 w-8 h-4 bg-slate-300 rounded-l-sm border-2 border-slate-400 z-0"></div>

            <!-- 2. æ³¨å°„å™¨ã®ç­’ï¼ˆæœ¬ä½“ï¼‰ -->
            <div id="cylinder" class="relative flex-grow h-full bg-slate-50 border-4 border-slate-400 rounded-r-lg ml-2 overflow-hidden z-10 transition-colors duration-300">
                
                <!-- ç›®ç››ã‚Š -->
                <div class="absolute inset-0 flex justify-between px-10 pointer-events-none opacity-40">
                    <div class="h-4 w-1 bg-slate-500 mt-auto mb-2"></div>
                    <div class="h-6 w-1 bg-slate-500 mt-auto mb-2"></div>
                    <div class="h-4 w-1 bg-slate-500 mt-auto mb-2"></div>
                    <div class="h-6 w-1 bg-slate-500 mt-auto mb-2"></div>
                    <div class="h-4 w-1 bg-slate-500 mt-auto mb-2"></div>
                    <div class="h-6 w-1 bg-slate-500 mt-auto mb-2"></div>
                </div>

                <!-- ç©ºæ°—ãŒå…¥ã£ã¦ã„ã‚‹ç©ºé–“ -->
                <div id="air-chamber" class="h-full w-full relative">
                    <!-- ã“ã“ã«JavaScriptã§ç²’ãŒç”Ÿæˆã•ã‚Œã¾ã™ -->
                </div>
            </div>

            <!-- 3. ãƒ”ã‚¹ãƒˆãƒ³ï¼ˆå‹•ãéƒ¨åˆ†ï¼‰ -->
            <!-- leftãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ä½ç½®ã‚’åˆ¶å¾¡ã€‚widthã‚’120%ã«ã—ã¦æ£’ã‚’é•·ãç¢ºä¿ -->
            <div id="piston" class="absolute h-full flex items-center cursor-grab touch-none z-50" style="left: 90%; width: 120%;">
                
                <!-- ãƒ”ã‚¹ãƒˆãƒ³ã®ã‚´ãƒ éƒ¨åˆ†ï¼ˆç­’ã®ä¸­ï¼‰ -->
                <!-- é«˜ã•ã‚’èª¿æ•´ã—ã¦ç­’ã®ä¸­ã«ã´ã£ãŸã‚Šåã¾ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ -->
                <div class="w-6 md:w-8 bg-slate-700 rounded-l-md shadow-lg flex items-center justify-center relative -ml-3 flex-shrink-0" style="height: calc(100% - 8px);">
                    <div class="w-1 h-[80%] bg-slate-500 rounded-full"></div>
                </div>

                <!-- ãƒ”ã‚¹ãƒˆãƒ³ã®æ£’ (flex-growã§ä¼¸ã³ã‚‹) -->
                <div class="h-6 md:h-8 flex-grow bg-slate-300 border-y-2 border-slate-400 relative">
                    <!-- ã‚¬ã‚¤ãƒ‰æ–‡å­—ã¯å‰Šé™¤æ¸ˆã¿ -->
                </div>

                <!-- ãƒ”ã‚¹ãƒˆãƒ³ã®æŒã¡æ‰‹ -->
                <div class="w-10 md:w-14 h-20 md:h-28 bg-blue-500 hover:bg-blue-600 border-b-4 border-blue-700 rounded-md shadow-lg flex items-center justify-center transition-colors flex-shrink-0">
                    <div class="w-1/3 h-1/2 bg-white/20 rounded-sm"></div>
                </div>

                <!-- ã‚¿ãƒƒãƒåˆ¤å®šã‚’åºƒã’ã‚‹ãŸã‚ã®é€æ˜ãªã‚¨ãƒªã‚¢ï¼ˆæ“ä½œã—ã‚„ã™ãã™ã‚‹ãŸã‚ï¼‰ -->
                <div class="absolute -top-10 -bottom-10 -left-10 -right-10"></div>
            </div>
        </div>
    </div>

    <!-- è§£èª¬ã‚¨ãƒªã‚¢ -->
    <div class="mt-8 bg-white/80 p-4 rounded-xl max-w-2xl text-center border border-blue-100 shadow-sm">
        <h2 class="text-lg font-bold text-blue-800 flex items-center justify-center gap-2">
            <span class="text-2xl">ğŸ’¡</span> ã‚ã‹ã£ãŸã“ã¨
        </h2>
        <p class="text-slate-700 mt-2 text-sm leading-relaxed">
            ç©ºæ°—ã¯<span class="font-bold text-blue-600">ãŠã™ã¨ç¸®ï¼ˆã¡ãƒ‚ï¼‰ã‚€</span>ã‚ˆã€‚<br>
            ã§ã‚‚ã€ãŠã›ã°ãŠã™ã»ã©ã€<span class="font-bold text-red-500 bg-red-100 px-1 rounded">ãŠã—è¿”ã™åŠ›</span>ãŒå¼·ããªã‚‹ã‚“ã ã€‚
        </p>
    </div>

    <script>
        // --- è¨­å®šã‚¨ãƒªã‚¢ ---
        const CONFIG = {
            particleCount: 100,      // ç©ºæ°—ã®ç²’ã®æ•°ï¼ˆ100å€‹ã«å¢—é‡ï¼‰
            minWidthPercent: 20,    // ã©ã“ã¾ã§æŠ¼ã—è¾¼ã‚ã‚‹ã‹ï¼ˆ20%ã¾ã§åœ§ç¸®å¯èƒ½ï¼‰
            defaultWidthPercent: 90 // åˆæœŸã®ãƒ”ã‚¹ãƒˆãƒ³ä½ç½®ï¼ˆ90%ï¼‰
        };

        // DOMè¦ç´ ã®å–å¾—
        const cylinder = document.getElementById('cylinder');
        const airChamber = document.getElementById('air-chamber');
        const piston = document.getElementById('piston');

        // çŠ¶æ…‹å¤‰æ•°
        let isDragging = false;
        let particles = [];
        let cylinderRect = cylinder.getBoundingClientRect();
        let currentPistonX = 0; // ãƒ”ã‚¹ãƒˆãƒ³ã®ã‚´ãƒ éƒ¨åˆ†ã®Xåº§æ¨™ï¼ˆcylinderå†…ï¼‰

        // åˆæœŸåŒ–å‡¦ç†
        function init() {
            createParticles();
            window.addEventListener('resize', onResize);
            
            // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŒç¢ºå®šã—ã¦ã‹ã‚‰åˆæœŸä½ç½®ã‚’è¨­å®š
            setTimeout(() => {
                onResize();
                setPistonPositionByPercent(CONFIG.defaultWidthPercent);
                animate();
            }, 100);
        }

        // ç”»é¢ã‚µã‚¤ã‚ºå¤‰æ›´æ™‚ã®å¯¾å¿œ
        function onResize() {
            cylinderRect = cylinder.getBoundingClientRect();
        }

        // ç©ºæ°—ã®ç²’ã‚’ç”Ÿæˆ
        function createParticles() {
            airChamber.innerHTML = '';
            particles = [];
            const fragment = document.createDocumentFragment();

            for (let i = 0; i < CONFIG.particleCount; i++) {
                const el = document.createElement('div');
                el.className = 'particle air';
                fragment.appendChild(el);
                
                particles.push({
                    el: el,
                    x: Math.random() * 100, // 0-100%ã®ä½ç½®
                    y: Math.random() * 100,
                    // åŸºæœ¬ã‚¹ãƒ”ãƒ¼ãƒ‰ï¼ˆã‚†ã£ãã‚Šã‚: 3ï¼‰
                    vx: (Math.random() - 0.5) * 3, 
                    vy: (Math.random() - 0.5) * 3
                });
            }
            airChamber.appendChild(fragment);
        }

        // ãƒ”ã‚¹ãƒˆãƒ³ã®ä½ç½®ã‚’ï¼…ã§è¨­å®šã™ã‚‹é–¢æ•°
        function setPistonPositionByPercent(percent) {
            // ç¯„å›²åˆ¶é™
            if (percent < CONFIG.minWidthPercent) percent = CONFIG.minWidthPercent;
            if (percent > 100) percent = 100;

            const pixelWidth = (cylinderRect.width * percent) / 100;
            
            // ãƒ”ã‚¹ãƒˆãƒ³ã®ä½ç½®æ›´æ–°
            piston.style.left = `${percent}%`;
            currentPistonX = pixelWidth;
        }

        // --- ãƒ‰ãƒ©ãƒƒã‚°æ“ä½œ (Pointer Events) ---
        piston.addEventListener('pointerdown', (e) => {
            e.preventDefault();
            isDragging = true;
            piston.setPointerCapture(e.pointerId);
            piston.classList.add('grabbing');
            cylinderRect = cylinder.getBoundingClientRect(); // åº§æ¨™å†å–å¾—
        });

        piston.addEventListener('pointermove', (e) => {
            if (!isDragging) return;
            e.preventDefault();

            // ãƒã‚¦ã‚¹/æŒ‡ã®Xåº§æ¨™ã¨ã€ç­’ã®å·¦ç«¯ã¨ã®è·é›¢
            const relativeX = e.clientX - cylinderRect.left;
            
            // ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆã«å¤‰æ›
            let percent = (relativeX / cylinderRect.width) * 100;
            
            setPistonPositionByPercent(percent);
        });

        const stopDrag = (e) => {
            isDragging = false;
            piston.classList.remove('grabbing');
        };

        piston.addEventListener('pointerup', stopDrag);
        piston.addEventListener('pointercancel', stopDrag);


        // --- ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ— (ç²’ã®å‹•ã) ---
        function animate() {
            const width = currentPistonX; // ç¾åœ¨ã®ç©ºæ°—å®¤ã®å¹…(px)
            const height = cylinderRect.height;
            const maxW = cylinderRect.width;
            let speedMultiplier = 1;
            
            if (width > 0) {
                // åŠ é€Ÿå€ç‡ï¼ˆã»ã©ã‚ˆãåŠ é€Ÿ: æœ€å¤§5å€ï¼‰
                speedMultiplier = 1 + (1 - (width / maxW)) * 5; 
            }

            particles.forEach(p => {
                // ç§»å‹•
                p.x += p.vx * speedMultiplier;
                p.y += p.vy * speedMultiplier;

                // è·³ã­è¿”ã‚Šå‡¦ç† (ä»®æƒ³åº§æ¨™ 0-100)
                if (p.x < 0) { p.x = 0; p.vx *= -1; }
                if (p.x > 100) { p.x = 100; p.vx *= -1; }
                
                if (p.y < 0) { p.y = 0; p.vy *= -1; }
                if (p.y > 100) { p.y = 100; p.vy *= -1; }

                // æç”»ä½ç½®ã®æ±ºå®š
                const drawX = (p.x / 100) * (width - 8); // -8ã¯ç²’ã®ã‚µã‚¤ã‚º
                const drawY = (p.y / 100) * (height - 8);

                p.el.style.transform = `translate(${drawX}px, ${drawY}px)`;
            });

            requestAnimationFrame(animate);
        }

        // ã‚¹ã‚¿ãƒ¼ãƒˆ
        init();

    </script>
</body>
</html>